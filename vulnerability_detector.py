import requests

BASE_URL = "http://localhost:3000"
XSS_PAYLOADS = ["<script>alert(1)</script>", "<u>test</u>"]
SQLI_PAYLOADS = ["'", "' OR 1=1--"]

alerts = set()

def run_assessment():
    print("Checking the application for security flaws...\n")

    for p in XSS_PAYLOADS:
        res = requests.get(f"{BASE_URL}/rest/products/search", params={"q": p})
        if p in res.text: 
            alerts.add("Found a Reflected XSS vulnerability in the search bar.")

    for p in SQLI_PAYLOADS:
        res = requests.post(f"{BASE_URL}/rest/user/login", json={"email": p, "password": "p"})
        if res.status_code == 500 or "SQLITE_ERROR" in res.text.upper():
            alerts.add("The login page seems vulnerable to SQL Injection.")

    headers = requests.get(BASE_URL).headers
    for h in ["Content-Security-Policy", "Strict-Transport-Security", "X-Content-Type-Options"]:
        if h not in headers:
            alerts.add(f"The server is missing the {h} security header.")

    print("Vulnerability Report: \n")
    if alerts:
        for a in sorted(alerts):
            print(f"-> {a}")
    else:
        print("Everything looks clean. No issues found.")

if __name__ == "__main__":
    run_assessment()